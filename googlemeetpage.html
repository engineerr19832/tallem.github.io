<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Persistent Storage Example</title>
        <!-- Other head elements like meta, title, CSS, etc. -->        
        <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>
        <script src="https://apis.google.com/js/api.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <script src="loadattendeailfromfirestore.js"></script>         
        <script>
    document.addEventListener('DOMContentLoaded', function() {
        const savedValuesList = document.getElementById('savedValuesList');
        const storedEmail = localStorage.getItem('loggedInEmail');
        const createinvit = document.getElementById('createinvit');
        const endtime = document.getElementById('endtime');
        const starttime = document.getElementById('starttime');
        const meetingdesc = document.getElementById('meetingdesc');
        const repeatevery = document.getElementById('repeatevery');
        const repeatfrequency = document.getElementById('repeatFrequency');
        const numofoccur = document.getElementById('numofoccur');
        console.log('enabledisable', storedEmail);
        console.log('length', savedValuesList.children.length);

        // Function to check the list and enable/disable the button
        function checkList() {
            let shouldEnableButton = false;

            // Iterate through each child and compare with storedEmail
            for (let i = 0; i < savedValuesList.children.length; i++) {
                const listItem = savedValuesList.children[i];
                const childValue = listItem.textContent.trim();

                if (childValue === storedEmail) {
                    console.log('Match found:', childValue, storedEmail);
                    shouldEnableButton = true;
                } else {
                    console.log('No Match found:', childValue, storedEmail);
                }
            }

            // Enable or disable the button based on the comparison
            createinvit.disabled = !shouldEnableButton;
            starttime.disabled = !shouldEnableButton;
            endtime.disabled = !shouldEnableButton;
            meetingdesc.disabled = !shouldEnableButton;
            repeatevery.disabled = !shouldEnableButton;
            repeatfrequency.disabled = !shouldEnableButton;
            numofoccur.disabled = !shouldEnableButton;
            console.log('test:', shouldEnableButton, storedEmail);
        }

        // Attach the event listener to trigger the checkList function
        // Use event delegation by attaching listener to a parent element or document
        document.addEventListener('click', function(event) {
            if (event.target.closest('.checkListTrigger')) {
                checkList();
            }
        });
    });
</script>         
        <script src="googlemeetpage_AR.js"></script>
        <script src="waitingalert.js"></script>
        <script src="newmeetingeventswindow_AR.js"></script>
        <script src="updatemeetingwindow_AR.js"></script>
        <script src=" stopsavetogdchannel.js"></script>
        <script src="refresh_token.js"></script>
    </head>
    <body bgcolor="#ffffe0">
        <h6 style="font-weight:bold;color:#000000;margin-bottom: 4px;">Enter:Google Meet list of attendees emails with the</h5>
        <h5 style="font-weight:bold;color:#ff0000;font-style:'Times New Roman';margin-top: 4px;margin-bottom: 6px;">logged email in blue bold font (REQUIRED)</h4>
        <input type="email" id="attendeeEmail" name="attendeeEmail" placeholder="Enter attendee's email here.." style="height: 25px; width: 290px; background-color: #ddfcf7;margin-top: 6px;margin-bottom: 2.5px;" required>
        <button id="sendinvit" style="height: 25px;margin-top: 2.5px;margin-bottom: 7px;">Add attendees</button>         
        <script src="sendinvtoattendee.js"></script>         
        <div id="container" style="display: flex; align-items: flex-start; margin-top: 15px;">
            <div>
                <h5 style="margin-bottom: 2px;margin-top: 7px;">Attendee Emails</h5>
              
<ul id="savedValuesList" style="
    list-style: none; 
    margin: 0; 
    padding: 0; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    background-color: #fff; 
    width: 300px; 
    max-height: 25px; 
    overflow: hidden; 
    cursor: pointer;
    position: relative;
    z-index: 10;
">
</ul>
  </div>
         </div>   
            <button id="deleteattendee1" style="
    position: fixed; 
    top: 153px; 
    left: 199px; ">Delete Attendee</button>

<script>
    // Expand list on click
    document.getElementById('savedValuesList').addEventListener('click', function (event) {
        event.stopPropagation(); // Prevent collapse when clicking inside the list
        this.style.maxHeight = 'none'; // Expand the list fully
        this.style.overflowY = 'auto'; // Allow scrolling for large lists
    });

    // Collapse list when clicking outside
    document.addEventListener('click', function (event) {
        const savedValuesList = document.getElementById('savedValuesList');
        if (!savedValuesList.contains(event.target)) {
            savedValuesList.style.maxHeight = '25px'; // Shrink the list back
            savedValuesList.style.overflowY = 'hidden'; // Hide overflow
        }
    });
</script>

           <script>
            // Handle deletion
    document.getElementById('deleteattendee1').addEventListener('click', function() {
        const selectedItem = document.querySelector('#savedValuesList li.selected');
        if (selectedItem) {
            selectedItem.remove();
        }
    });
</script>
        
        <style>/* Style for selected item */#savedValuesList li.selected { background-color: #b3d9ff; color: #333; width: 100%; padding: 10px; box-sizing: border-box; }</style>
        <div style="display: flex; justify-content: flex-end; padding: 20px;">
            <h6 id="texttip" style=" 
                background-color: #ffffdd;
                font-style: Times New Roman;
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Fixed position */
                right: 97px; /* Distance from the right edge */
                top: 233px; /* Distance from the top edge */
                display: flex;
                margin: 0; /* Remove default margin */
                /* Additional inline styles here if needed */
            ">
           Enter: (Meeting description-Start time-End time <br>and No of occurrences) to create a new meeting. </h6>
        </div>

        
 <div style="display: flex; justify-content: flex-end; padding: 20px;" class="checkListTrigger">
            <input id="meetingdesc" name="meetingdesc" placeholder="Enter the Meeting desc here.." style="
                height: 25px; 
                width: 280px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 5px; /* Distance from the right edge */
                top: 283px;
                /* Additional inline styles here if needed */
            " required>
        </div>
     <!-- Start Time -->
<!-- Container for the input with title -->
   <!-- Start Time -->
<div style="position: fixed;  left: 150px; top: 310px; padding: 10px; width: 380px;">
    <input 
        type="datetime-local" 
        id="starttime" 
        name="starttime" 
        placeholder="Enter the start time here.." 
        style="
            height: 125px; 
            width: 100%; 
            background-color: #ddfcf7; 
            font-weight: bold; 
        " 
        required
    >
</div>

        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script>
        flatpickr("#starttime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i", // Customize date format
            placeholder: "Enter date and time"
        });
    </script>
      <div style="position: fixed;  left: 150px; top: 340px; padding: 10px; width: 380px;">
    <input 
        type="datetime-local" 
        id="endtime" 
        name="endtime" 
        placeholder="Enter the end time here.." 
        style="
            height: 125px; 
            width: 100%; 
            background-color: #ddfcf7; 
            text-align: center; 
            font-weight: bold; 
        " 
        required
    >
</div>
        <script>
    // Attach event listeners to all elements with class "checkListTrigger"
    document.querySelectorAll('.checkListTrigger').forEach(function(element) {
        element.addEventListener('click', function() {
            checkList();
        });
    });
</script>
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script>
        flatpickr("#endtime", {
            enableTime: true,
            dateFormat: "Y-m-d H:i", // Customize date format
            placeholder: "Enter date and time"
        });
    </script>


        
        <div style="display: flex; justify-content: flex-end; padding: 10px;">
            <span style="
        margin-right: 4px; /* Adjust the spacing between the title and input fields */
        position: fixed; 
        right: 190px; 
        top: 415px;
        font-size: 13px; /* Reduced font size */
    ">Repeat Every:</span>
            <input id="repeatevery" name="repeatevery" style="
                height: 20px; 
                width: 45px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 135px; /* Distance from the right edge */
                top: 415px;
                /* Additional inline styles here if needed */
            ">
            <select id="repeatFrequency" name="repeatFrequency" style="
            height: 25px; 
            width: 100px; 
            background-color: #ddfcf7; 
            text-align: center;
            font-weight: bold; 
            position: fixed; 
            right: 20px; 
            top: 415px;
        ">
                <option value="null"></option>
                <option value="Daily">Daily</option>
                <option value="Weekly">Weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Yearly">Yearly</option>
            </select>
            <div style="display: flex; justify-content: flex-end; padding: 20px;">
                <span style="
        font-size: 13px;
        margin-right: 4px; /* Adjust the spacing between the title and input fields */
        position: fixed; 
        right: 193px; 
        top: 450px;
    ">No of Occurs:</span>
                <input id="numofoccur" name="numofoccur" style="
                height: 20px; 
                width: 45px; 
                background-color: #ddfcf7; 
                text-align: center;
                font-weight: bold; /* Make font bold */
                position: fixed; /* Absolute position within .container */
                right: 135px; /* Distance from the right edge */
                top: 450px;
                /* Additional inline styles here if needed */
            "> 

                
                <button id="loadinvit" style="height: 35px; text-align: center; font-weight: bold; position: fixed; right: 35px; top: 515px;">
                    Load invit
              </button>
      <script>
const storage = firebase.storage();

document.addEventListener('DOMContentLoaded', function() {
    const loadInvitButton = document.getElementById('loadinvit');

    loadInvitButton.addEventListener('click', function() {
        let accessToken = localStorage.getItem('accessToken');

        refresh_token(accessToken)
            .then(newAccessToken => {
                accessToken = newAccessToken;

                const loggedInEmail = localStorage.getItem('loggedInEmail');
                const arpage = localStorage.getItem('arpage');
                console.log(loggedInEmail);

                if (accessToken && loggedInEmail) {
                    function loadMeetings() {
                        fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`,
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            const filteredEvents = data.items.filter(event => 
                                event.attendees && event.attendees.some(attendee => attendee.email === loggedInEmail)
                            );

                            const newWindow = window.open('', '_blank', 'toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');

                            // Default English content before buttons
                            newWindow.document.write('<html><head><title>Meetings</title></head><body>');
                            newWindow.document.write('<br><h1>Meetings</h1>');
                            newWindow.document.write('<ul style="list-style: none; margin: 0; padding: 0; font-size: 14px;">');

                            filteredEvents.forEach(event => {
                                const startTime = new Date(event.start.dateTime).toLocaleString();
                                const endTime = new Date(event.end.dateTime).toLocaleString();
                                const creatorEmail = event.creator.email;
                                localStorage.setItem('creatorEmail', creatorEmail);
                                const description = event.description || 'No description';
                                const hangoutLink = event.hangoutLink || 'No link available';

                                let recurrenceInfo = 'Single event';
                                if (event.recurrence) {
                                    recurrenceInfo = 'Recurring event';

                                    const recurrenceRule = event.recurrence[0];
                                    const countMatch = recurrenceRule.match(/COUNT=(\d+)/);
                                    if (countMatch) {
                                        recurrenceInfo += `, Occurs ${countMatch[1]} times`;
                                    }

                                    const freqMatch = recurrenceRule.match(/FREQ=(\w+)/);
                                    if (freqMatch) {
                                        recurrenceInfo += `, Frequency: ${freqMatch[1].toLowerCase()}`;
                                    }
                                }

                                newWindow.document.write(`
                                    <li style="margin-bottom: 5px; border-bottom: 1px solid #ccc;">
                                        <strong>Start Time:</strong> ${startTime}<br>
                                        <strong>End Time:</strong> ${endTime}<br>
                                        <strong>Creator's Email:</strong> ${creatorEmail}<br>
                                        <strong>Description:</strong> ${description}<br>
                                        <strong>Meeting Link:</strong> <a href="${hangoutLink}" target="_blank">${hangoutLink}</a><br>
                                        <strong>Meeting Type:</strong> ${recurrenceInfo}
                                    </li>
                                `);
                            });

                            newWindow.document.write('</ul>');

                            // Record and Stop buttons setup
                            const recordButton = newWindow.document.createElement('button');
                            recordButton.id = 'recordmeet';
                            recordButton.textContent = 'Start';
                            recordButton.style.backgroundColor = 'green';
                            recordButton.style.color = 'white';
                            recordButton.style.position = 'fixed';
                            recordButton.style.top = '10px';
                            recordButton.style.right = '10px';
                            recordButton.style.padding = '15px 30px';
                            recordButton.style.fontWeight = 'bold';
                            recordButton.style.fontSize = '40px';
                            recordButton.style.border = 'none';
                            recordButton.style.borderRadius = '5px';
                            recordButton.style.cursor = 'pointer';
                            recordButton.style.boxShadow = '0 4px #999';
                            recordButton.style.display = 'none';

                            recordButton.addEventListener('mousedown', function() {
                                this.style.backgroundColor = '#3e8e41';
                                this.style.boxShadow = '0 2px #666';
                                this.style.transform = 'translateY(2px)';
                            });

                            recordButton.addEventListener('mouseup', function() {
                                this.style.backgroundColor = 'green';
                                this.style.boxShadow = '0 4px #999';
                                this.style.transform = 'translateY(0px)';
                            });

                            const stopButton = newWindow.document.createElement('button');
                            stopButton.id = 'stoprecord';
                            stopButton.textContent = 'Stop';
                            stopButton.style.backgroundColor = 'red';
                            stopButton.style.color = 'white';
                            stopButton.style.position = 'fixed';
                            stopButton.style.top = '10px';
                            stopButton.style.right = '160px';
                            stopButton.style.padding = '15px 30px';
                            stopButton.style.fontWeight = 'bold';
                            stopButton.style.fontSize = '40px';
                            stopButton.style.border = 'none';
                            stopButton.style.borderRadius = '5px';
                            stopButton.style.cursor = 'pointer';
                            stopButton.style.boxShadow = '0 4px #999';
                            stopButton.disabled = true;
                            stopButton.style.display = 'none';

                            newWindow.document.body.appendChild(recordButton);
                            newWindow.document.body.appendChild(stopButton);

                            const backButton = newWindow.document.createElement('button');
                            backButton.id = 'backback';
                            backButton.textContent = 'Back';
                            backButton.style.backgroundColor = 'green';
                            backButton.style.color = 'white';
                            backButton.style.position = 'fixed';
                            backButton.style.top = '70px';
                            backButton.style.right = '40px';
                            backButton.style.padding = '20px 50px';
                            backButton.style.fontWeight = 'bold';
                            backButton.style.fontSize = '40px';
                            backButton.style.width = '150px';
                            backButton.style.height = '80px';
                            backButton.style.lineHeight = '80px';
                            backButton.style.textAlign = 'center';
                            backButton.style.border = 'none';
                            backButton.style.borderRadius = '5px';
                            backButton.style.cursor = 'pointer';
                            backButton.style.boxShadow = '0 4px #999';

                            backButton.addEventListener('click', function() {
                                newWindow.close();
                            });

                            newWindow.document.body.appendChild(backButton);

                            const stopSaveToGDriveButton = newWindow.document.createElement('button');
                            stopSaveToGDriveButton.id = 'stopsavetogd';
                            stopSaveToGDriveButton.textContent = 'Google';
                            stopSaveToGDriveButton.style.backgroundColor = '#f39c12';
                            stopSaveToGDriveButton.style.color = 'white';
                            stopSaveToGDriveButton.style.position = 'fixed';
                            stopSaveToGDriveButton.style.top = '10px';
                            stopSaveToGDriveButton.style.right = '305px';
                            stopSaveToGDriveButton.style.padding = '15px 30px';
                            stopSaveToGDriveButton.style.fontWeight = 'bold';
                            stopSaveToGDriveButton.style.fontSize = '40px';
                            stopSaveToGDriveButton.style.border = 'none';
                            stopSaveToGDriveButton.style.borderRadius = '5px';
                            stopSaveToGDriveButton.style.cursor = 'pointer';
                            stopSaveToGDriveButton.style.boxShadow = '0 4px #999';
                            stopSaveToGDriveButton.style.display = 'none';

                            stopSaveToGDriveButton.addEventListener('click', function() {
                                alert("Video saved to Google Drive.");
                                drive();
                            });

                            newWindow.document.body.appendChild(stopSaveToGDriveButton);

                            if (arpage === 'ar') {
                                console.log("Arabic translation condition met");
                                loadArabicContent(newWindow, filteredEvents);
                            }

                            newWindow.document.write('</body></html>');
                            newWindow.document.close();
                        })
                        .catch(error => console.error('Error fetching meetings:', error));
                    }

                    loadMeetings();
                } else {
                    alert("User is not authenticated.");
                }
            });
    });
});
</script>


              <div style="
    position: fixed; 
    height: 2.5px; 
    width: 85%; 
    background-color: black; 
    top: 505px; /* Place 5px above the button */
    left: 23px; /* Span the entire width */
    z-index: 2; /* Ensure the line is above the button */
"></div>
                <button id="updateinvit" style=" height: 35px; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 130px; /* Distance from the right edge */
               top: 515px;
                    z-index: 1; /* Ensure the button is below the line */
                /* Additional inline styles here if needed */
            ">Update invit</button>
     <script>
document.getElementById("updateinvit").onclick = function() {
    var accessToken = localStorage.getItem('accessToken');

    refresh_token(accessToken)
    .then(newAccessToken => {
        accessToken = newAccessToken;

        var loggedInEmail = localStorage.getItem('loggedInEmail');
        var meetings = [];
        var currentIndex = 0;

        function loadMeetings() {
            if (accessToken && loggedInEmail) {
                fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    meetings = data.items.filter(event => 
                        event.creator.email === loggedInEmail
                    );
                    if (meetings.length === 0) {
                        alert('No meetings found');
                    } else {
                        showMeeting(meetings[currentIndex]);
                    }
                })
                .catch(error => {
                    console.error('Error fetching meetings:', error);
                    alert('Failed to load meetings');
                });
            } else {
                alert('Missing access token or logged-in email');
            }
        }

        function parseRecurrenceRule(recurrence) {
            if (!recurrence || !recurrence[0].startsWith('RRULE:')) return {};

            const rule = recurrence[0].replace('RRULE:', '').split(';');
            const result = {};

            rule.forEach(part => {
                const [key, value] = part.split('=');
                if (key === 'FREQ') {
                    result.frequency = value.toLowerCase();
                } else if (key === 'INTERVAL') {
                    result.interval = parseInt(value, 10);
                } else if (key === 'COUNT') {
                    result.count = parseInt(value, 10);
                }
            });

            return result;
        }

        function showMeeting(meeting) {
            if (!meeting) {
                alert('No meeting data available');
                return;
            }
            var updateWindow = window.open("", "Update Meetings", "width=800,height=600");
            updateWindow.document.body.innerHTML = '';
            const recurrenceDetails = parseRecurrenceRule(meeting.recurrence);
            updateWindow.document.write('<title>Update Meeting Details</title>');
            updateWindow.document.write('<h2 style="font-size: 55px;">Update Meetings</h2>');
            updateWindow.document.write(`
                <style>
                    .selected {
                        background-color: #b3d9ff; /* Highlight with a light blue color */
                    }
                </style>
            `);
            updateWindow.document.write(`
                <p><h2 style="font-size: 40px;">Description:</h2> <input type="text" id="description" style="width: 700px; height: 80px; font-size: 40px; background-color: rgba(0, 255, 255, 0.5);" value="${meeting.description || ''}"></p>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <h1 style="font-size: 40px; margin: 0;">Start Time:</h1>
                    <input 
                        type="datetime-local" 
                        id="startTime" 
                        style="width: 350px; font-size: 35px; background-color: rgba(0, 255, 255, 0.5);" 
                        value="${meeting.start.dateTime ? new Date(meeting.start.dateTime).toISOString().slice(0, 16) : ''}">
                </p>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <h1 style="font-size: 40px; margin: 0;">End Time:</h1> 
                    <input type="datetime-local" id="endTime" style="width: 350px; font-size: 35px; background-color: rgba(0, 255, 255, 0.5);" value="${meeting.end.dateTime ? new Date(meeting.end.dateTime).toISOString().slice(0, 16) : ''}">
                </p>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <h1 style="font-size: 40px; margin: 0;">Rep. Every:</h1> 
                    <input type="number" id="repeatevery" style="width: 150px; height: 60px; font-size: 35px; background-color: rgba(0, 255, 255, 0.5); text-align: center;" value="${recurrenceDetails.interval || ''}">
                </p>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <h1 style="font-size: 40px; margin: 0;">Freq:</h1>
                    <select id="repeatFrequency" style="width: 150px; height: 60px; font-size: 35px; background-color: rgba(0, 255, 255, 0.5); text-align: center;">
                        <option value="null"></option>
                        <option value="daily" ${recurrenceDetails.frequency === 'daily' ? 'selected' : ''}>Daily</option>
                        <option value="weekly" ${recurrenceDetails.frequency === 'weekly' ? 'selected' : ''}>Weekly</option>
                        <option value="monthly" ${recurrenceDetails.frequency === 'monthly' ? 'selected' : ''}>Monthly</option>
                        <option value="yearly" ${recurrenceDetails.frequency === 'yearly' ? 'selected' : ''}>Yearly</option>
                    </select>
                </p>
                <p style="display: flex; align-items: center; gap: 10px;">
                    <h1 style="font-size: 40px; margin: 0;">Occur:</h1> 
                    <input type="number" id="numofoccur" style="width: 100px; height: 60px; font-size: 35px; background-color: rgba(0, 255, 255, 0.5); text-align: center;" value="${recurrenceDetails.count || ''}">
                </p>
                   <ul id="attendeesList" style="
    list-style: none; 
    margin: 0; 
    padding: 0; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    background-color: #fff; 
    width: 750px; 
    font-size: 40px;
    max-height: 200px; 
    overflow-y: auto; 
    cursor: pointer;
    position: relative;
    z-index: 10;
"></ul><br>
            <input type="text" id="attendeeEmail" placeholder="Add Attendee" style="width: 700px;height: 80px; background-color: rgba(144, 238, 144, 0.5); font-size: 37px;"><br>

             &nbsp;<p style="text-align: center;">
            <button id="addAttendee" style="width: 285px; height: 70px; font-size: 40px;">Add Attendee</button>
            &nbsp;<button id="deleteAttendee" style="width: 285px; height: 70px; font-size: 40px;">Del Attendee</button><br><br>
            <button id="previous" style="width: 285px; height: 70px; font-size: 40px;">Previous</button>  &nbsp;<button id="next" style="width: 285px; height: 70px; font-size: 40px;">Next</button><br><br>
            <button id="updateMeeting" style="width: 285px; height: 70px; font-size: 40px;">Upd Meeting</button> &nbsp;<button id="deleteMeeting" style="width: 285px; height: 70px; font-size: 40px;">Del Meeting</button><br><br>
            <button id="backbutton2" style="width: 285px; height: 70px; font-size: 40px;">Back</button>
             </p>
            `);
            // Additional content (unchanged logic)
     // Add event listener for the "Back" button
    updateWindow.document.getElementById('backbutton2').addEventListener('click', function () {
        updateWindow.close();
    });
      const attendeesList = updateWindow.document.getElementById('attendeesList');
// Clear and populate the list
attendeesList.innerHTML = '';
if (meeting.attendees) {
    meeting.attendees.forEach(function(attendee) {
        var li = updateWindow.document.createElement('li');
        li.className = 'attendee-item';
        li.textContent = attendee.email;
        attendeesList.appendChild(li);
    });
}
                // Make list items clickable and selectable
const attendeeItems = attendeesList.getElementsByTagName('li'); // Get all <li> items inside the list
for (let item of attendeeItems) {
    item.addEventListener('click', function(event) {
        // Remove 'selected' class from all items
        for (let i of attendeeItems) {
            i.classList.remove('selected'); // Remove 'selected' class from all items
        }

        // Add 'selected' class to the clicked item
        item.classList.add('selected');
    });
}
        var addAttendeeInput = updateWindow.document.getElementById('attendeeEmail');
        var addAttendeeButton = updateWindow.document.getElementById('addAttendee');
        var deleteAttendeeButton = updateWindow.document.getElementById('deleteAttendee');
        addAttendeeButton.onclick = function() {
            var newAttendee = addAttendeeInput.value.trim();
            if (newAttendee && !Array.from(attendeesList.children).some(li => li.textContent === newAttendee)) {
                var li = updateWindow.document.createElement('li');
                li.className = 'attendee-item';
                li.textContent = newAttendee;
                attendeesList.appendChild(li);
                meeting.attendees.push({ email: newAttendee });
            } else {
                updateWindow.alert('Attendee already added or email is empty');
            }
        };
        deleteAttendeeButton.onclick = function() {
            var selectedAttendee = updateWindow.document.querySelector('ul#attendeesList li.selected');
            if (selectedAttendee) {
                meeting.attendees = meeting.attendees.filter(function(att) {
                    return att.email !== selectedAttendee.textContent;
                });
                attendeesList.removeChild(selectedAttendee);
            } else {
                updateWindow.alert('Please select an attendee to delete');
            }
        };
        attendeesList.onclick = function(event) {
            if (event.target && event.target.matches("li.attendee-item")) {
                var selectedItems = updateWindow.document.querySelectorAll('ul#attendeesList li.selected');
                selectedItems.forEach(function(item) {
                    item.classList.remove('selected');
                });
                event.target.classList.add('selected');
            }
        };
        updateWindow.document.getElementById('next').onclick = function() {
            currentIndex = (currentIndex + 1) % meetings.length;
            showMeeting(meetings[currentIndex]);
        };

        updateWindow.document.getElementById('previous').onclick = function() {
            currentIndex = (currentIndex - 1 + meetings.length) % meetings.length;
            showMeeting(meetings[currentIndex]);
        };

       updateWindow.document.getElementById('updateMeeting').onclick = function() {
    var filteredAttendees = meeting.attendees.map(attendee => ({ email: attendee.email }));
    var updatedMeeting = {
        summary: meeting.summary,
        description: updateWindow.document.getElementById('description').value,
        start: { 
            dateTime: new Date(updateWindow.document.getElementById('startTime').value).toISOString(),
            timeZone: "Asia/Baghdad" // Include the Baghdad time zone
        },
        end: { 
            dateTime: new Date(updateWindow.document.getElementById('endTime').value).toISOString(),
            timeZone: "Asia/Baghdad" // Include the Baghdad time zone
        },
        attendees: filteredAttendees
    };

    var repeatEvery = updateWindow.document.getElementById('repeatevery').value;
    var repeatFrequency = updateWindow.document.getElementById('repeatFrequency').value.toUpperCase();
    var numOfOccur = updateWindow.document.getElementById('numofoccur').value;

    if (repeatEvery && repeatFrequency && numOfOccur) {
        updatedMeeting.recurrence = [
            `RRULE:FREQ=${repeatFrequency};INTERVAL=${repeatEvery};COUNT=${numOfOccur}`
        ];
    }

    var xhrUpdate = new XMLHttpRequest();
    xhrUpdate.open('PUT', 'https://www.googleapis.com/calendar/v3/calendars/primary/events/' + meeting.id + '?access_token=' + accessToken);
    xhrUpdate.setRequestHeader('Content-Type', 'application/json');
    xhrUpdate.onload = function() {
        if (xhrUpdate.status === 200) {
            var updatedRecurrence = updatedMeeting.recurrence ? updatedMeeting.recurrence.join(", ") : 'None';
            updateWindow.alert(`Meeting updated:\n${JSON.stringify(updatedMeeting)}\nRecurrence: ${updatedRecurrence}`);
        } else {
            updateWindow.alert('Failed to update meeting');
            console.error('Error:', xhrUpdate.responseText);
        }
    };
    xhrUpdate.send(JSON.stringify(updatedMeeting));
};


        updateWindow.document.getElementById('deleteMeeting').onclick = function() {
            var xhrDelete = new XMLHttpRequest();
            xhrDelete.open('DELETE', 'https://www.googleapis.com/calendar/v3/calendars/primary/events/' + meeting.id + '?access_token=' + accessToken);
            xhrDelete.onload = function() {
                if (xhrDelete.status === 204) {
                    updateWindow.alert('Meeting deleted');
                    currentIndex = (currentIndex + 1) % meetings.length;
                    showMeeting(meetings[currentIndex]);
                } else {
                    updateWindow.alert('Failed to delete meeting');
                }
            };
            xhrDelete.send();
        };
         
    if (localStorage.getItem('arpage') === 'ar') {
            translateToArabic_up(updateWindow);
      }
        }
        loadMeetings();
    });
};
</script>
                <button id="createinvit" style=" height: 35px; 
                text-align: center;
                font-weight: bold; /* Make font bold */
               position: fixed; /* Absolute position within .container */
               right: 245px; /* Distance from the right edge */
               top: 515px;
                /* Additional inline styles here if needed */
            ">Create invit</button>
                <script>
    document.addEventListener('DOMContentLoaded', function() {
        const savedValuesList = document.getElementById('savedValuesList');
        const startTimeInput = document.getElementById('starttime');
        const endTimeInput = document.getElementById('endtime');
        const descInput = document.getElementById('meetingdesc');
        const createInvitButton = document.getElementById('createinvit');
        const repeatEveryInput = document.getElementById('repeatevery');
        const repeatFrequencyInput = document.getElementById('repeatFrequency');
        const numOfOccurInput = document.getElementById('numofoccur');

        function validateInputs() {
            if (startTimeInput.value === '' || endTimeInput.value === '') {
                alert("Please enter both start time and end time.");
                return false;
            }
            return true;
        }

        function generateRequestId() {
            return 'req-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
        }

        const accessToken = localStorage.getItem('accessToken');

        refresh_token(accessToken)
        .then(newAccessToken => {
        accessToken = newAccessToken;
                    
        console.log('access token is:', accessToken);

        function createMeetingEvent() {
            if (savedValuesList.children.length > 0 && accessToken) {
                const attendees = Array.from(savedValuesList.children).map(item => ({ email: item.textContent }));
                const startTime = new Date(startTimeInput.value).toISOString();
                const endTime = new Date(endTimeInput.value).toISOString();
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

                const event = {
                    summary: 'Meeting Event',
                    description: descInput.value,
                    start: { dateTime: startTime, timeZone: timeZone },
                    end: { dateTime: endTime, timeZone: timeZone },
                    attendees: attendees,
                    conferenceData: {
                        createRequest: {
                            requestId: generateRequestId(),
                            conferenceSolutionKey: {
                                type: "hangoutsMeet"
                            }
                        }
                    }
                };

                // Validate and construct the RRULE
                if (repeatEveryInput.value && repeatFrequencyInput.value && numOfOccurInput.value) {
                    const freq = repeatFrequencyInput.value.toUpperCase(); // Convert to uppercase (e.g., DAILY, WEEKLY)
                    const interval = parseInt(repeatEveryInput.value); // Convert to an integer
                    const count = parseInt(numOfOccurInput.value); // Convert to an integer

                    // Check that all values are valid
                    if (!isNaN(interval) && !isNaN(count) && ['DAILY', 'WEEKLY', 'MONTHLY', 'YEARLY'].includes(freq)) {
                        event.recurrence = [
                            `RRULE:FREQ=${freq};INTERVAL=${interval};COUNT=${count}`
                        ];
                    } else {
                        console.error('Invalid recurrence inputs.');
                        alert('Invalid recurrence inputs.');
                        return;
                    }
                }

                fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?conferenceDataVersion=1', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(event),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error creating event:', data.error.message);
                    } else {
                        console.log('Event created:', data);
                        const conferenceId = data.conferenceData.createRequest.conferenceSolutionKey.type;
                        const createdDate = new Date(data.created).toLocaleString();
                        const creatorEmail = data.creator.email;
                        const hangoutLink = data.hangoutLink;
                        const startTime = new Date(data.start.dateTime).toLocaleString();
                        const endTime = new Date(data.end.dateTime).toLocaleString();
                        const recurrence = data.recurrence ? data.recurrence.join(", ") : 'None';
                        const status = data.status;
                        const summary = data.summary;
                        const description = data.description;

                        const alertMessage = `
                            Creation of the meeting event successful, details:
                            Conference ID: ${conferenceId}
                            Created Date: ${createdDate}
                            Creator Email: ${creatorEmail}
                            Hangout Link: ${hangoutLink}
                            Start Time: ${startTime}
                            End Time: ${endTime}
                            Recurrence: ${recurrence}
                            Status: ${status}
                            Summary: ${summary}
                            Description: ${description}
                        `;

                        alert(alertMessage);
                    }
                })
                .catch(error => {
                    console.error('Error creating event:', error);
                    alert('There was an error creating the meeting event.');
                });
            } else {
                console.error('Access token is missing or no attendees available.');
            }
        }

        createInvitButton.addEventListener('click', function() {
            if (validateInputs()) { 
                createMeetingEvent();
            }
        });
    });
</script>                 
                <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if localStorage has 'arpage' set to 'ar' after the content is fully loaded
            const arpage = localStorage.getItem('arpage');
            if (arpage === 'ar') {
                translateGoogleMeetPage(); // Call the translation function from the external JS file
            }
        });
    </script>

                
<script>

    // Expand the list or select an item when clicking inside the list
savedValuesList.addEventListener('click', function (event) {
    // Prevent the collapse action when clicking on the <ul> or <li>
    event.stopPropagation();

    // Handle list item selection if <li> is clicked
    if (event.target.tagName === 'LI') {
        // Deselect all previously selected items
        const previouslySelectedItems = savedValuesList.querySelectorAll('li.selected');
        previouslySelectedItems.forEach(function (item) {
            item.classList.remove('selected');
            item.style.backgroundColor = ''; // Reset background color
        });

        // Select the clicked item
        event.target.classList.add('selected');
        event.target.style.backgroundColor = 'aqua'; // Highlight selected item
    }

    // Expand the list when clicking on the <ul> or an <li>
    savedValuesList.style.maxHeight = 'none'; // Fully expand based on content
    savedValuesList.style.overflowY = 'auto'; // Allow scrolling for large lists
});

// Collapse list and deselect item when clicking outside
document.addEventListener('click', function (event) {
    if (!savedValuesList.contains(event.target)) {
        savedValuesList.style.maxHeight = '25px'; // Collapse to show only the first item
        savedValuesList.style.overflowY = 'hidden'; // Hide overflow

        // Deselect all selected items when clicking outside
        const selectedItems = savedValuesList.querySelectorAll('li.selected');
        selectedItems.forEach(function (item) {
            item.classList.remove('selected'); // Remove the selected class
            item.style.backgroundColor = ''; // Reset background color (optional)
        });
    }
});
    
</script>

                
    </body>
</html>
